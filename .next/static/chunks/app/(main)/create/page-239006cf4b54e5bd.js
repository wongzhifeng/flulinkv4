(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{2274:function(e,t,a){Promise.resolve().then(a.bind(a,3689))},3689:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),n=a(2265),i=a(2995),c=a(6741),r=a(3448),l=a(257);class o{constructor(e=l.env.NEXT_PUBLIC_AI_SERVICE_URL||"http://localhost:8000"){this.propagationAgent={async calculatePropagationPath(e,t){return(await fetch("".concat(this.aiServiceUrl,"/api/ai/optimize-propagation"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:e,context:t})})).json()},async predictPropagationPotential(e){let t=await fetch("".concat(this.aiServiceUrl,"/api/ai/predict-potential"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:e})});return(await t.json()).potential_score}},this.matchingAgent={async findSimilarUsers(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,s=await fetch("".concat(this.aiServiceUrl,"/api/ai/find-similar-users"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed_vector:e,user_pool:t.map(e=>({id:e.id,interest_vector:e.interest_vector})),limit:a})});return(await s.json()).similar_users},async calculateUserCompatibility(e,t){let a=await fetch("".concat(this.aiServiceUrl,"/api/ai/calculate-compatibility"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user1:e,user2:t})});return(await a.json()).compatibility_score}},this.contentAgent={async analyzeContent(e){return(await fetch("".concat(this.aiServiceUrl,"/api/ai/analyze-content"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})})).json()},async generateContentVector(e){let t=await fetch("".concat(this.aiServiceUrl,"/api/ai/embed-text"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});return(await t.json()).vector},async extractSpectralTags(e){let t=await fetch("".concat(this.aiServiceUrl,"/api/ai/extract-tags"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});return(await t.json()).tags}},this.optimizationAgent={async optimizePropagationPath(e){return(await fetch("".concat(this.aiServiceUrl,"/api/ai/optimize-path"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})).json()},async calculateOptimalTiming(e,t){let a=await fetch("".concat(this.aiServiceUrl,"/api/ai/calculate-timing"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed:e,users:t})});return(await a.json()).optimal_times.map(e=>new Date(e))}},this.aiServiceUrl=e}}let d=new o,m=e=>{let{currentUser:t,onSeedCreated:a,className:i}=e,[l,o]=(0,n.useState)([{id:(0,r.Ox)(),role:"assistant",content:"你好！我是你的 AI 创作助手。你想创作什么样的星种？描述你的想法，我会帮你优化和传播。",timestamp:new Date}]),[m,p]=(0,n.useState)(""),[x,h]=(0,n.useState)(!1),[u,y]=(0,n.useState)(!1),[f,g]=(0,n.useState)(!1),[j,v]=(0,n.useState)(null),[N,S]=(0,n.useState)([]),[b,w]=(0,n.useState)(""),_=(0,n.useRef)(null),{analyzeContent:O,generateContentVector:C,extractSpectralTags:T}=d.contentAgent,P=()=>{var e;null===(e=_.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{P()},[l]);let k=async()=>{if(!m.trim()||x)return;let e={id:(0,r.Ox)(),role:"user",content:m.trim(),timestamp:new Date};o(t=>[...t,e]),p(""),h(!0);try{let e=await O(m.trim()),a=await D(m.trim(),e),s=await T(a),n=await z(a,e),i=I(e,a),c={id:(0,r.Ox)(),role:"assistant",content:U(a,e,i),metadata:{suggested_content:a,confidence:i,estimated_reach:n,spectral_tags:s},timestamp:new Date};o(e=>[...e,c]),i>.8&&(v({id:(0,r.Ox)(),creator:t.id,content:a,content_type:"text",location:t.location,content_vector:[],spectral_tags:s,luminosity:Math.round(100*i),resonance_count:0,status:"active",created:new Date().toISOString(),updated:new Date().toISOString()}),S(s))}catch(t){console.error("AI 生成失败:",t);let e={id:(0,r.Ox)(),role:"assistant",content:"抱歉，我遇到了一些问题。请稍后再试，或者尝试重新描述你的想法。",timestamp:new Date};o(t=>[...t,e])}finally{h(!1)}},D=async(e,t)=>{let a=["".concat(e," - 这是一个很棒的想法！"),'关于"'.concat(e,'"的思考：这让我想起了...'),"分享：".concat(e,"，希望能引起大家的共鸣"),"感悟：".concat(e,"，生活就是这样美好")];return a[Math.floor(Math.random()*a.length)]},z=async(e,t)=>Math.round((Math.floor(500*Math.random())+100)*("positive"===t.sentiment?1.5:1)*(t.topics.includes("生活")?1.3:1)),I=(e,t)=>{let a=.5;return t.length>20&&t.length<200&&(a+=.2),"positive"===e.sentiment&&(a+=.2),e.topics.length>0&&(a+=.1),Math.min(1,a)},U=(e,t,a)=>a>.8?'我为你优化了这个内容："'.concat(e,'"。这个星种很有潜力，预计能传播给 ').concat(Math.floor(500*Math.random())+100," 人。你觉得怎么样？"):a>.6?'我理解你的想法。让我为你优化一下："'.concat(e,'"。这个内容还不错，但可能需要一些调整。'):"我理解你的想法，但可能需要更多信息来帮你创作。你能再详细描述一下吗？",M=async()=>{if(j){y(!0);try{let e={...j,spectral_tags:N,created:new Date().toISOString(),updated:new Date().toISOString()};await new Promise(e=>setTimeout(e,1e3)),a(e),v(null),S([]),g(!1);let t={id:(0,r.Ox)(),role:"assistant",content:"\uD83C\uDF89 星种创建成功！它已经开始在星空中传播了。",timestamp:new Date};o(e=>[...e,t])}catch(e){console.error("创建星种失败:",e)}finally{y(!1)}}},J=()=>{b.trim()&&!N.includes(b.trim())&&(S(e=>[...e,b.trim()]),w(""))},A=e=>{S(t=>t.filter(t=>t!==e))};return(0,s.jsxs)("div",{className:(0,r.cn)("flex flex-col h-full",i),children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[l.map(e=>(0,s.jsx)("div",{className:(0,r.cn)("flex","user"===e.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:(0,r.cn)("max-w-[80%] rounded-2xl px-4 py-3","user"===e.role?"bg-gradient-gold text-black":"bg-primary-card text-text-primary"),children:[(0,s.jsx)("p",{className:"text-sm",children:e.content}),"assistant"===e.role&&e.metadata&&(0,s.jsxs)("div",{className:"mt-2 space-y-2",children:[e.metadata.confidence&&(0,s.jsxs)("div",{className:"text-xs text-text-secondary",children:["置信度: ",Math.round(100*e.metadata.confidence),"%"]}),e.metadata.estimated_reach&&(0,s.jsxs)("div",{className:"text-xs text-text-secondary",children:["预计传播: ",e.metadata.estimated_reach," 人"]}),e.metadata.spectral_tags&&e.metadata.spectral_tags.length>0&&(0,s.jsx)("div",{className:"flex gap-1 flex-wrap",children:e.metadata.spectral_tags.map((e,t)=>(0,s.jsxs)(c.Vp,{variant:"cyan",size:"sm",children:["#",e]},t))}),e.metadata.suggested_content&&e.metadata.confidence&&e.metadata.confidence>.6&&(0,s.jsxs)(c.zx,{size:"sm",variant:"secondary",onClick:()=>{v({id:(0,r.Ox)(),creator:t.id,content:e.metadata.suggested_content,content_type:"text",location:t.location,content_vector:[],spectral_tags:e.metadata.spectral_tags||[],luminosity:Math.round(100*e.metadata.confidence),resonance_count:0,status:"active",created:new Date().toISOString(),updated:new Date().toISOString()}),S(e.metadata.spectral_tags||[]),g(!0)},className:"mt-2",children:[(0,s.jsx)("i",{className:"fas fa-eye mr-1"}),"预览星种"]})]}),(0,s.jsx)("div",{className:"text-xs text-text-secondary mt-1",children:(0,r.p6)(e.timestamp)})]})},e.id)),x&&(0,s.jsx)("div",{className:"flex justify-start",children:(0,s.jsx)("div",{className:"bg-primary-card text-text-primary rounded-2xl px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(c.gb,{size:"sm"}),(0,s.jsx)("span",{className:"text-sm",children:"AI 思考中..."})]})})}),(0,s.jsx)("div",{ref:_})]}),(0,s.jsx)("div",{className:"border-t border-white/10 p-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.gx,{value:m,onChange:e=>p(e.target.value),placeholder:"描述你的想法...",disabled:x,className:"flex-1 min-h-[60px] resize-none",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())}}),(0,s.jsx)(c.zx,{onClick:k,disabled:!m.trim()||x,className:"self-end",children:x?(0,s.jsx)(c.gb,{size:"sm"}):(0,s.jsx)("i",{className:"fas fa-paper-plane"})})]})}),(0,s.jsx)(c.u_,{isOpen:f,onClose:()=>g(!1),title:"星种预览",size:"lg",children:j&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"星种内容"}),(0,s.jsx)("div",{className:"bg-primary-secondary rounded-xl p-4 text-text-primary",children:j.content})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"光谱标签"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("div",{className:"flex gap-2 flex-wrap",children:N.map((e,t)=>(0,s.jsxs)(c.Vp,{variant:"cyan",className:"cursor-pointer",onClick:()=>A(e),children:["#",e," ",(0,s.jsx)("i",{className:"fas fa-times ml-1"})]},t))}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(c.II,{value:b,onChange:e=>w(e.target.value),placeholder:"添加自定义标签",className:"flex-1",onKeyDown:e=>{"Enter"===e.key&&J()}}),(0,s.jsx)(c.zx,{onClick:J,variant:"secondary",children:(0,s.jsx)("i",{className:"fas fa-plus"})})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"光度值"}),(0,s.jsx)("div",{className:"bg-primary-secondary rounded-xl p-3 text-center",children:(0,s.jsxs)("span",{className:"text-2xl font-bold text-accent-gold",children:[j.luminosity,"\xb0C"]})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"预计传播"}),(0,s.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-3 text-center",children:[(0,s.jsx)("span",{className:"text-2xl font-bold text-accent-red",children:Math.floor(500*Math.random())+100}),(0,s.jsx)("div",{className:"text-sm text-text-secondary",children:"人"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsxs)(c.zx,{onClick:M,loading:u,className:"flex-1",children:[(0,s.jsx)("i",{className:"fas fa-rocket mr-2"}),"发射星种"]}),(0,s.jsx)(c.zx,{onClick:()=>g(!1),variant:"secondary",children:"取消"})]})]})})]})};var p=a(6886),x=a(9376);function h(){let e=(0,x.useRouter)(),t=p.pb.authStore.model||{};return(0,s.jsxs)("div",{className:"min-h-screen bg-primary-bg",children:[(0,s.jsx)(i.tD,{title:"创建星种",user:{name:t.username||"用户",avatar:t.avatar},onMenuClick:()=>e.push("/"),onProfileClick:()=>e.push("/profile")}),(0,s.jsx)("main",{className:"pt-16 pb-20 px-4",children:(0,s.jsx)("div",{className:"max-w-md mx-auto h-[calc(100vh-8rem)]",children:(0,s.jsx)(m,{currentUser:t,onSeedCreated:t=>{e.push("/")},className:"h-full"})})}),(0,s.jsx)(i.LJ,{currentPage:"create",onPageChange:t=>e.push("home"===t?"/":"/".concat(t))})]})}}},function(e){e.O(0,[137,579,436,971,117,744],function(){return e(e.s=2274)}),_N_E=e.O()}]);
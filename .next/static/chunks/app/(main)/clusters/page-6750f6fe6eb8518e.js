(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[442],{432:function(e,t,s){Promise.resolve().then(s.bind(s,2880))},2880:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(7437),i=s(2265),r=s(2995),c=s(6741),n=s(3448),l=s(257);class o{async addUserInterestVector(e,t){await fetch("".concat(this.aiServiceUrl,"/api/vector/user-interests"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,vector:t})})}async updateUserInterestVector(e,t){await fetch("".concat(this.aiServiceUrl,"/api/vector/user-interests/").concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vector:t})})}async findSimilarUsers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await fetch("".concat(this.aiServiceUrl,"/api/vector/user-interests/search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query_vector:e,limit:t.limit||10,min_distance:t.minDistance,max_distance:t.maxDistance})});return(await s.json()).results}async addContentVector(e,t){await fetch("".concat(this.aiServiceUrl,"/api/vector/content-similarity"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content_id:e,vector:t})})}async findSimilarContent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await fetch("".concat(this.aiServiceUrl,"/api/vector/content-similarity/search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query_vector:e,limit:t.limit||20,min_distance:t.minDistance,max_distance:t.maxDistance})});return(await s.json()).results}async addClusterVector(e,t){await fetch("".concat(this.aiServiceUrl,"/api/vector/cluster-compatibility"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:e,vector:t})})}async findCompatibleClusters(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=await fetch("".concat(this.aiServiceUrl,"/api/vector/cluster-compatibility/search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query_vector:e,limit:t.limit||5,min_distance:t.minDistance,max_distance:t.maxDistance})});return(await s.json()).results}async batchAddVectors(e,t){await fetch("".concat(this.aiServiceUrl,"/api/vector/").concat(e,"/batch"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vectors:t})})}async batchSearch(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=await fetch("".concat(this.aiServiceUrl,"/api/vector/").concat(e,"/batch-search"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queries:t,limit:s.limit||10,min_distance:s.minDistance,max_distance:s.maxDistance})});return(await a.json()).results}async createCollection(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"cosine";await fetch("".concat(this.aiServiceUrl,"/api/vector/collections"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,dimension:t,distance_metric:s})})}async listCollections(){let e=await fetch("".concat(this.aiServiceUrl,"/api/vector/collections"));return(await e.json()).collections}async deleteCollection(e){await fetch("".concat(this.aiServiceUrl,"/api/vector/collections/").concat(e),{method:"DELETE"})}async healthCheck(){return(await fetch("".concat(this.aiServiceUrl,"/api/vector/health"))).json()}constructor(e=l.env.NEXT_PUBLIC_AI_SERVICE_URL||"http://localhost:8000"){this.aiServiceUrl=e}}new o;let d=e=>{let{currentUser:t,onClusterClick:s,onJoinCluster:r,onLeaveCluster:l,className:o}=e,[d,m]=(0,i.useState)([]),[x,h]=(0,i.useState)(!0),[p,u]=(0,i.useState)(null),[v,f]=(0,i.useState)("nearby"),[y,j]=(0,i.useState)([]),[g,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{h(!0);let e=[{id:"1",members:["user1","user2","user3","user4","user5"],core_users:["user1","user2"],resonance_score:85,geographic_center:{lat:39.9042,lng:116.4074},activity_level:92,spectral_diversity:{topics:["生活","科技","艺术"],count:3},expiration_time:new Date(Date.now()+6048e5).toISOString(),cluster_vector:[.1,.2,.3,.4,.5],created:new Date().toISOString(),updated:new Date().toISOString()},{id:"2",members:["user6","user7","user8","user9"],core_users:["user6","user7"],resonance_score:78,geographic_center:{lat:39.9142,lng:116.4174},activity_level:88,spectral_diversity:{topics:["摄影","旅行","美食"],count:3},expiration_time:new Date(Date.now()+432e6).toISOString(),cluster_vector:[.2,.3,.4,.5,.6],created:new Date().toISOString(),updated:new Date().toISOString()}];m(e)}catch(e){console.error("获取星团数据失败:",e)}finally{h(!1)}})()},[]);let N=(0,i.useCallback)(async e=>{b(!0);try{let e=[{id:"user1",username:"星空探索者",email:"user1@example.com",avatar:"",location:{lat:39.9042,lng:116.4074,precision:"high"},interest_vector:[.1,.2,.3],interaction_history:{},privacy_settings:{},ai_preferences:{},created:new Date().toISOString(),updated:new Date().toISOString(),resonanceScore:95,lastActive:new Date().toISOString(),contribution:85},{id:"user2",username:"创意达人",email:"user2@example.com",avatar:"",location:{lat:39.9142,lng:116.4174,precision:"high"},interest_vector:[.2,.3,.4],interaction_history:{},privacy_settings:{},ai_preferences:{},created:new Date().toISOString(),updated:new Date().toISOString(),resonanceScore:88,lastActive:new Date().toISOString(),contribution:92}];j(e)}catch(e){console.error("获取星团成员失败:",e)}finally{b(!1)}},[]),S=e=>{u(e),N(e.id),s(e)},_=async e=>{try{await r(e),m(s=>s.map(s=>s.id===e?{...s,members:[...s.members,t.id]}:s))}catch(e){console.error("加入星团失败:",e)}},w=async e=>{try{await l(e),m(s=>s.map(s=>s.id===e?{...s,members:s.members.filter(e=>e!==t.id)}:s))}catch(e){console.error("离开星团失败:",e)}},C=e=>t.interest_vector&&e.cluster_vector?t.interest_vector.reduce((t,s,a)=>{var i;return t+s*((null===(i=e.cluster_vector)||void 0===i?void 0:i[a])||0)},0)/(Math.sqrt(t.interest_vector.reduce((e,t)=>e+t*t,0))*Math.sqrt(e.cluster_vector.reduce((e,t)=>e+t*t,0))):0,O=e=>t.location&&e.geographic_center?(0,n.cL)(t.location.lat,t.location.lng,e.geographic_center.lat,e.geographic_center.lng):0,k=e=>e.members.includes(t.id),D=e=>(new Date(e.expiration_time).getTime()-Date.now())/36e5<24;return x?(0,a.jsx)(c.Zb,{className:(0,n.cn)("h-96 flex items-center justify-center",o),children:(0,a.jsx)(c.gb,{text:"加载星团中..."})}):(0,a.jsxs)("div",{className:(0,n.cn)("space-y-4",o),children:[(0,a.jsx)("div",{className:"flex gap-2",children:[{key:"nearby",label:"附近星团",icon:"fas fa-map-marker-alt"},{key:"active",label:"活跃星团",icon:"fas fa-fire"},{key:"compatible",label:"兼容星团",icon:"fas fa-heart"}].map(e=>{let{key:t,label:s,icon:i}=e;return(0,a.jsxs)(c.zx,{onClick:()=>f(t),variant:v===t?"primary":"secondary",size:"sm",children:[(0,a.jsx)("i",{className:(0,n.cn)(i,"mr-1")}),s]},t)})}),(0,a.jsx)("div",{className:"grid gap-4",children:d.map(e=>{var t,s;let i=C(e),r=O(e),l=k(e),o=D(e);return(0,a.jsx)(c.Zb,{className:"cursor-pointer hover:transform hover:-translate-y-1 transition-all duration-300",onClick:()=>S(e),children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary",children:["星团 #",e.id]}),o&&(0,a.jsxs)(c.Vp,{variant:"red",size:"sm",children:[(0,a.jsx)("i",{className:"fas fa-clock mr-1"}),"即将过期"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-users mr-1"}),e.members.length," 成员"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-fire mr-1"}),e.activity_level,"% 活跃度"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-heart mr-1"}),e.resonance_score," 共鸣值"]}),r>0&&(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-map-marker-alt mr-1"}),r.toFixed(1),"km"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"兼容性"}),(0,a.jsxs)("div",{className:(0,n.cn)("text-lg font-bold",i>.8?"text-accent-gold":i>.6?"text-accent-cyan":"text-text-secondary"),children:[Math.round(100*i),"%"]})]}),l?(0,a.jsxs)(c.zx,{variant:"danger",size:"sm",onClick:t=>{t.stopPropagation(),w(e.id)},children:[(0,a.jsx)("i",{className:"fas fa-sign-out-alt mr-1"}),"离开"]}):(0,a.jsxs)(c.zx,{variant:"primary",size:"sm",onClick:t=>{t.stopPropagation(),_(e.id)},disabled:e.members.length>=49,children:[(0,a.jsx)("i",{className:"fas fa-plus mr-1"}),"加入"]})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary mb-1",children:"光谱多样性"}),(0,a.jsx)("div",{className:"flex gap-1 flex-wrap",children:null===(s=e.spectral_diversity)||void 0===s?void 0:null===(t=s.topics)||void 0===t?void 0:t.map((e,t)=>(0,a.jsxs)(c.Vp,{variant:"cyan",size:"sm",children:["#",e]},t))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"核心成员:"}),(0,a.jsxs)("div",{className:"flex -space-x-2",children:[e.core_users.slice(0,3).map((e,t)=>(0,a.jsx)(c.qE,{size:"sm",fallback:e.charAt(0).toUpperCase(),className:"border-2 border-primary-card"},t)),e.core_users.length>3&&(0,a.jsxs)("div",{className:"w-8 h-8 rounded-full bg-primary-secondary border-2 border-primary-card flex items-center justify-center text-xs text-text-secondary",children:["+",e.core_users.length-3]})]})]}),(0,a.jsxs)("div",{className:"mt-3 text-xs text-text-secondary",children:[(0,a.jsx)("i",{className:"fas fa-clock mr-1"}),"剩余时间: ",(0,n.p6)(e.expiration_time)]})]})},e.id)})}),p&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>u(null)}),(0,a.jsx)("div",{className:"relative w-full max-w-2xl bg-primary-card rounded-2xl shadow-2xl",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-text-primary",children:["星团详情 #",p.id]}),(0,a.jsx)("button",{onClick:()=>u(null),className:"text-text-secondary hover:text-accent-gold transition-colors",children:(0,a.jsx)("i",{className:"fas fa-times text-xl"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-4 text-center",children:[(0,a.jsx)("div",{className:"text-2xl font-bold text-accent-gold mb-1",children:p.resonance_score}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"共鸣值"})]}),(0,a.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-4 text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-accent-red mb-1",children:[p.activity_level,"%"]}),(0,a.jsx)("div",{className:"text-sm text-text-secondary",children:"活跃度"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:["星团成员 (",y.length,")"]}),g?(0,a.jsx)(c.gb,{text:"加载成员中..."}):(0,a.jsx)("div",{className:"space-y-3",children:y.map(e=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-primary-secondary rounded-xl",children:[(0,a.jsx)(c.qE,{size:"md",fallback:e.username.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,a.jsx)("span",{className:"font-medium text-text-primary",children:e.username}),e.id===t.id&&(0,a.jsx)(c.Vp,{variant:"gold",size:"sm",children:"你"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-heart mr-1"}),e.resonanceScore," 共鸣"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-chart-line mr-1"}),e.contribution,"% 贡献"]}),(0,a.jsxs)("span",{children:[(0,a.jsx)("i",{className:"fas fa-clock mr-1"}),(0,n.p6)(e.lastActive)]})]})]})]},e.id))})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[k(p)?(0,a.jsxs)(c.zx,{variant:"danger",onClick:()=>{w(p.id),u(null)},className:"flex-1",children:[(0,a.jsx)("i",{className:"fas fa-sign-out-alt mr-2"}),"离开星团"]}):(0,a.jsxs)(c.zx,{variant:"primary",onClick:()=>{_(p.id),u(null)},className:"flex-1",disabled:p.members.length>=49,children:[(0,a.jsx)("i",{className:"fas fa-plus mr-2"}),"加入星团"]}),(0,a.jsx)(c.zx,{variant:"secondary",onClick:()=>u(null),children:"关闭"})]})]})})]})]})};var m=s(6886),x=s(9376);function h(){let e=(0,x.useRouter)(),t=m.pb.authStore.model||{};return(0,a.jsxs)("div",{className:"min-h-screen bg-primary-bg",children:[(0,a.jsx)(r.tD,{title:"星团共鸣",user:{name:t.username||"用户",avatar:t.avatar},onMenuClick:()=>e.push("/"),onProfileClick:()=>e.push("/profile")}),(0,a.jsx)("main",{className:"pt-16 pb-20 px-4",children:(0,a.jsx)("div",{className:"max-w-md mx-auto",children:(0,a.jsx)(d,{currentUser:t,onClusterClick:e=>{},onJoinCluster:e=>{},onLeaveCluster:e=>{}})})}),(0,a.jsx)(r.LJ,{currentPage:"clusters",onPageChange:t=>e.push("home"===t?"/":"/".concat(t))})]})}}},function(e){e.O(0,[137,579,436,971,117,744],function(){return e(e.s=432)}),_N_E=e.O()}]);
(()=>{var e={};e.id=442,e.ids=[442],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4387:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>p,tree:()=>o}),s(8701),s(5866),s(2029);var a=s(3191),r=s(8716),i=s(7922),n=s.n(i),c=s(5231),l={};for(let e in c)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(l[e]=()=>c[e]);s.d(t,l);let o=["",{children:["(main)",{children:["clusters",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,8701)),"/Users/mac/Desktop/code/flulink/src/app/(main)/clusters/page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,2029)),"/Users/mac/Desktop/code/flulink/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mac/Desktop/code/flulink/src/app/(main)/clusters/page.tsx"],m="/(main)/clusters/page",x={require:s,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(main)/clusters/page",pathname:"/clusters",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},623:(e,t,s)=>{Promise.resolve().then(s.bind(s,840))},840:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>x});var a=s(326),r=s(7577),i=s(1364),n=s(2068),c=s(1223);class l{constructor(e=process.env.NEXT_PUBLIC_AI_SERVICE_URL||"http://localhost:8000"){this.aiServiceUrl=e}async addUserInterestVector(e,t){await fetch(`${this.aiServiceUrl}/api/vector/user-interests`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:e,vector:t})})}async updateUserInterestVector(e,t){await fetch(`${this.aiServiceUrl}/api/vector/user-interests/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({vector:t})})}async findSimilarUsers(e,t={}){let s=await fetch(`${this.aiServiceUrl}/api/vector/user-interests/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query_vector:e,limit:t.limit||10,min_distance:t.minDistance,max_distance:t.maxDistance})});return(await s.json()).results}async addContentVector(e,t){await fetch(`${this.aiServiceUrl}/api/vector/content-similarity`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content_id:e,vector:t})})}async findSimilarContent(e,t={}){let s=await fetch(`${this.aiServiceUrl}/api/vector/content-similarity/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query_vector:e,limit:t.limit||20,min_distance:t.minDistance,max_distance:t.maxDistance})});return(await s.json()).results}async addClusterVector(e,t){await fetch(`${this.aiServiceUrl}/api/vector/cluster-compatibility`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({cluster_id:e,vector:t})})}async findCompatibleClusters(e,t={}){let s=await fetch(`${this.aiServiceUrl}/api/vector/cluster-compatibility/search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query_vector:e,limit:t.limit||5,min_distance:t.minDistance,max_distance:t.maxDistance})});return(await s.json()).results}async batchAddVectors(e,t){await fetch(`${this.aiServiceUrl}/api/vector/${e}/batch`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({vectors:t})})}async batchSearch(e,t,s={}){let a=await fetch(`${this.aiServiceUrl}/api/vector/${e}/batch-search`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({queries:t,limit:s.limit||10,min_distance:s.minDistance,max_distance:s.maxDistance})});return(await a.json()).results}async createCollection(e,t,s="cosine"){await fetch(`${this.aiServiceUrl}/api/vector/collections`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,dimension:t,distance_metric:s})})}async listCollections(){let e=await fetch(`${this.aiServiceUrl}/api/vector/collections`);return(await e.json()).collections}async deleteCollection(e){await fetch(`${this.aiServiceUrl}/api/vector/collections/${e}`,{method:"DELETE"})}async healthCheck(){return(await fetch(`${this.aiServiceUrl}/api/vector/health`)).json()}}new l;let o=({currentUser:e,onClusterClick:t,onJoinCluster:s,onLeaveCluster:i,className:l})=>{let[o,d]=(0,r.useState)([]),[m,x]=(0,r.useState)(!0),[p,h]=(0,r.useState)(null),[u,v]=(0,r.useState)("nearby"),[f,y]=(0,r.useState)([]),[j,g]=(0,r.useState)(!1);(0,r.useEffect)(()=>{(async()=>{try{x(!0);let e=[{id:"1",members:["user1","user2","user3","user4","user5"],core_users:["user1","user2"],resonance_score:85,geographic_center:{lat:39.9042,lng:116.4074},activity_level:92,spectral_diversity:{topics:["生活","科技","艺术"],count:3},expiration_time:new Date(Date.now()+6048e5).toISOString(),cluster_vector:[.1,.2,.3,.4,.5],created:new Date().toISOString(),updated:new Date().toISOString()},{id:"2",members:["user6","user7","user8","user9"],core_users:["user6","user7"],resonance_score:78,geographic_center:{lat:39.9142,lng:116.4174},activity_level:88,spectral_diversity:{topics:["摄影","旅行","美食"],count:3},expiration_time:new Date(Date.now()+432e6).toISOString(),cluster_vector:[.2,.3,.4,.5,.6],created:new Date().toISOString(),updated:new Date().toISOString()}];d(e)}catch(e){console.error("获取星团数据失败:",e)}finally{x(!1)}})()},[]);let b=(0,r.useCallback)(async e=>{g(!0);try{let e=[{id:"user1",username:"星空探索者",email:"user1@example.com",avatar:"",location:{lat:39.9042,lng:116.4074,precision:"high"},interest_vector:[.1,.2,.3],interaction_history:{},privacy_settings:{},ai_preferences:{},created:new Date().toISOString(),updated:new Date().toISOString(),resonanceScore:95,lastActive:new Date().toISOString(),contribution:85},{id:"user2",username:"创意达人",email:"user2@example.com",avatar:"",location:{lat:39.9142,lng:116.4174,precision:"high"},interest_vector:[.2,.3,.4],interaction_history:{},privacy_settings:{},ai_preferences:{},created:new Date().toISOString(),updated:new Date().toISOString(),resonanceScore:88,lastActive:new Date().toISOString(),contribution:92}];y(e)}catch(e){console.error("获取星团成员失败:",e)}finally{g(!1)}},[]),N=e=>{h(e),b(e.id),t(e)},_=async t=>{try{await s(t),d(s=>s.map(s=>s.id===t?{...s,members:[...s.members,e.id]}:s))}catch(e){console.error("加入星团失败:",e)}},S=async t=>{try{await i(t),d(s=>s.map(s=>s.id===t?{...s,members:s.members.filter(t=>t!==e.id)}:s))}catch(e){console.error("离开星团失败:",e)}},w=t=>e.interest_vector&&t.cluster_vector?e.interest_vector.reduce((e,s,a)=>e+s*(t.cluster_vector?.[a]||0),0)/(Math.sqrt(e.interest_vector.reduce((e,t)=>e+t*t,0))*Math.sqrt(t.cluster_vector.reduce((e,t)=>e+t*t,0))):0,C=t=>e.location&&t.geographic_center?(0,c.cL)(e.location.lat,e.location.lng,t.geographic_center.lat,t.geographic_center.lng):0,k=t=>t.members.includes(e.id),O=e=>(new Date(e.expiration_time).getTime()-Date.now())/36e5<24;return m?a.jsx(n.Zb,{className:(0,c.cn)("h-96 flex items-center justify-center",l),children:a.jsx(n.gb,{text:"加载星团中..."})}):(0,a.jsxs)("div",{className:(0,c.cn)("space-y-4",l),children:[a.jsx("div",{className:"flex gap-2",children:[{key:"nearby",label:"附近星团",icon:"fas fa-map-marker-alt"},{key:"active",label:"活跃星团",icon:"fas fa-fire"},{key:"compatible",label:"兼容星团",icon:"fas fa-heart"}].map(({key:e,label:t,icon:s})=>(0,a.jsxs)(n.zx,{onClick:()=>v(e),variant:u===e?"primary":"secondary",size:"sm",children:[a.jsx("i",{className:(0,c.cn)(s,"mr-1")}),t]},e))}),a.jsx("div",{className:"grid gap-4",children:o.map(e=>{let t=w(e),s=C(e),r=k(e),i=O(e);return a.jsx(n.Zb,{className:"cursor-pointer hover:transform hover:-translate-y-1 transition-all duration-300",onClick:()=>N(e),children:(0,a.jsxs)("div",{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary",children:["星团 #",e.id]}),i&&(0,a.jsxs)(n.Vp,{variant:"red",size:"sm",children:[a.jsx("i",{className:"fas fa-clock mr-1"}),"即将过期"]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-users mr-1"}),e.members.length," 成员"]}),(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-fire mr-1"}),e.activity_level,"% 活跃度"]}),(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-heart mr-1"}),e.resonance_score," 共鸣值"]}),s>0&&(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-map-marker-alt mr-1"}),s.toFixed(1),"km"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("div",{className:"text-center",children:[a.jsx("div",{className:"text-sm text-text-secondary",children:"兼容性"}),(0,a.jsxs)("div",{className:(0,c.cn)("text-lg font-bold",t>.8?"text-accent-gold":t>.6?"text-accent-cyan":"text-text-secondary"),children:[Math.round(100*t),"%"]})]}),r?(0,a.jsxs)(n.zx,{variant:"danger",size:"sm",onClick:t=>{t.stopPropagation(),S(e.id)},children:[a.jsx("i",{className:"fas fa-sign-out-alt mr-1"}),"离开"]}):(0,a.jsxs)(n.zx,{variant:"primary",size:"sm",onClick:t=>{t.stopPropagation(),_(e.id)},disabled:e.members.length>=49,children:[a.jsx("i",{className:"fas fa-plus mr-1"}),"加入"]})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[a.jsx("div",{className:"text-sm text-text-secondary mb-1",children:"光谱多样性"}),a.jsx("div",{className:"flex gap-1 flex-wrap",children:e.spectral_diversity?.topics?.map((e,t)=>a.jsxs(n.Vp,{variant:"cyan",size:"sm",children:["#",e]},t))})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[a.jsx("div",{className:"text-sm text-text-secondary",children:"核心成员:"}),(0,a.jsxs)("div",{className:"flex -space-x-2",children:[e.core_users.slice(0,3).map((e,t)=>a.jsx(n.qE,{size:"sm",fallback:e.charAt(0).toUpperCase(),className:"border-2 border-primary-card"},t)),e.core_users.length>3&&(0,a.jsxs)("div",{className:"w-8 h-8 rounded-full bg-primary-secondary border-2 border-primary-card flex items-center justify-center text-xs text-text-secondary",children:["+",e.core_users.length-3]})]})]}),(0,a.jsxs)("div",{className:"mt-3 text-xs text-text-secondary",children:[a.jsx("i",{className:"fas fa-clock mr-1"}),"剩余时间: ",(0,c.p6)(e.expiration_time)]})]})},e.id)})}),p&&(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[a.jsx("div",{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",onClick:()=>h(null)}),a.jsx("div",{className:"relative w-full max-w-2xl bg-primary-card rounded-2xl shadow-2xl",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold text-text-primary",children:["星团详情 #",p.id]}),a.jsx("button",{onClick:()=>h(null),className:"text-text-secondary hover:text-accent-gold transition-colors",children:a.jsx("i",{className:"fas fa-times text-xl"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-4 text-center",children:[a.jsx("div",{className:"text-2xl font-bold text-accent-gold mb-1",children:p.resonance_score}),a.jsx("div",{className:"text-sm text-text-secondary",children:"共鸣值"})]}),(0,a.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-4 text-center",children:[(0,a.jsxs)("div",{className:"text-2xl font-bold text-accent-red mb-1",children:[p.activity_level,"%"]}),a.jsx("div",{className:"text-sm text-text-secondary",children:"活跃度"})]})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold text-text-primary mb-3",children:["星团成员 (",f.length,")"]}),j?a.jsx(n.gb,{text:"加载成员中..."}):a.jsx("div",{className:"space-y-3",children:f.map(t=>(0,a.jsxs)("div",{className:"flex items-center gap-3 p-3 bg-primary-secondary rounded-xl",children:[a.jsx(n.qE,{size:"md",fallback:t.username.charAt(0).toUpperCase()}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[a.jsx("span",{className:"font-medium text-text-primary",children:t.username}),t.id===e.id&&a.jsx(n.Vp,{variant:"gold",size:"sm",children:"你"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4 text-sm text-text-secondary",children:[(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-heart mr-1"}),t.resonanceScore," 共鸣"]}),(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-chart-line mr-1"}),t.contribution,"% 贡献"]}),(0,a.jsxs)("span",{children:[a.jsx("i",{className:"fas fa-clock mr-1"}),(0,c.p6)(t.lastActive)]})]})]})]},t.id))})]}),(0,a.jsxs)("div",{className:"flex gap-3",children:[k(p)?(0,a.jsxs)(n.zx,{variant:"danger",onClick:()=>{S(p.id),h(null)},className:"flex-1",children:[a.jsx("i",{className:"fas fa-sign-out-alt mr-2"}),"离开星团"]}):(0,a.jsxs)(n.zx,{variant:"primary",onClick:()=>{_(p.id),h(null)},className:"flex-1",disabled:p.members.length>=49,children:[a.jsx("i",{className:"fas fa-plus mr-2"}),"加入星团"]}),a.jsx(n.zx,{variant:"secondary",onClick:()=>h(null),children:"关闭"})]})]})})]})]})};var d=s(8551),m=s(5047);function x(){let e=(0,m.useRouter)(),t=d.pb.authStore.model||{};return(0,a.jsxs)("div",{className:"min-h-screen bg-primary-bg",children:[a.jsx(i.tD,{title:"星团共鸣",user:{name:t.username||"用户",avatar:t.avatar},onMenuClick:()=>e.push("/"),onProfileClick:()=>e.push("/profile")}),a.jsx("main",{className:"pt-16 pb-20 px-4",children:a.jsx("div",{className:"max-w-md mx-auto",children:a.jsx(o,{currentUser:t,onClusterClick:e=>{},onJoinCluster:e=>{},onLeaveCluster:e=>{}})})}),a.jsx(i.LJ,{currentPage:"clusters",onPageChange:t=>e.push("home"===t?"/":`/${t}`)})]})}},8701:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>a});let a=(0,s(8570).createProxy)(String.raw`/Users/mac/Desktop/code/flulink/src/app/(main)/clusters/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[948,347,325,599,713],()=>s(4387));module.exports=a})();
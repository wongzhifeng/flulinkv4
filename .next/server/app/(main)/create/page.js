(()=>{var e={};e.id=50,e.ids=[50],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},6825:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>n.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>o}),a(7007),a(5866),a(2029);var s=a(3191),r=a(8716),i=a(7922),n=a.n(i),l=a(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);a.d(t,c);let o=["",{children:["(main)",{children:["create",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,7007)),"/Users/mac/Desktop/code/flulink/src/app/(main)/create/page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,2029)),"/Users/mac/Desktop/code/flulink/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mac/Desktop/code/flulink/src/app/(main)/create/page.tsx"],m="/(main)/create/page",p={require:a,loadChunk:()=>Promise.resolve()},h=new s.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/(main)/create/page",pathname:"/create",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8469:(e,t,a)=>{Promise.resolve().then(a.bind(a,3789))},3789:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var s=a(326),r=a(7577),i=a(1364),n=a(2068),l=a(1223);class c{constructor(e=process.env.NEXT_PUBLIC_AI_SERVICE_URL||"http://localhost:8000"){this.requestTimeout=1e4,this.retryAttempts=2,this.fallbackEnabled=!0,this.propagationAgent={async calculatePropagationPath(e,t){try{let a=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/optimize-propagation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:e,context:t})});return(await a.json()).optimal_path}catch(t){return console.warn("传播路径计算失败，使用降级策略:",t),{seedId:e.id,firstTargets:[],propagationSequence:[],estimatedReach:0,confidence:.1}}},async predictPropagationPotential(e){try{let t=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/predict-potential`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:e})});return(await t.json()).potential_score}catch(t){return console.warn("传播潜力预测失败，使用降级策略:",t),Math.min(100,Math.max(0,e.content?.length||0))}}},this.matchingAgent={async findSimilarUsers(e,t,a=10){try{let s=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/find-similar-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed_vector:e,user_pool:t.map(e=>({id:e.id,interest_vector:e.interest_vector})),limit:a})});return(await s.json()).similar_users}catch(e){return console.warn("相似用户查找失败，使用降级策略:",e),t.slice(0,a)}},async calculateUserCompatibility(e,t){try{let a=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/calculate-compatibility`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user1:e,user2:t})});return(await a.json()).compatibility_score}catch(a){if(console.warn("用户兼容性计算失败，使用降级策略:",a),e.interest_vector&&t.interest_vector){let a=e.interest_vector.reduce((e,a,s)=>e+a*(t.interest_vector?.[s]||0),0),s=Math.sqrt(e.interest_vector.reduce((e,t)=>e+t*t,0)),r=Math.sqrt(t.interest_vector.reduce((e,t)=>e+t*t,0));return s*r>0?a/(s*r):0}return .5*Math.random()+.3}}},this.contentAgent={async analyzeContent(e){try{let t=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/analyze-content`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});return await t.json()}catch(t){return console.warn("内容分析失败，使用降级策略:",t),this.fallbackContentAnalysis(e)}},async generateContentVector(e){try{let t=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/embed-text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});return(await t.json()).vector}catch(t){return console.warn("内容向量生成失败，使用降级策略:",t),this.generateFallbackVector(e)}},async extractSpectralTags(e){try{let t=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/extract-tags`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});return(await t.json()).tags}catch(t){return console.warn("光谱标签提取失败，使用降级策略:",t),this.fallbackTagExtraction(e)}}},this.optimizationAgent={async optimizePropagationPath(e){return(await fetch(`${this.aiServiceUrl}/api/ai/optimize-path`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})).json()},async calculateOptimalTiming(e,t){let a=await fetch(`${this.aiServiceUrl}/api/ai/calculate-timing`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed:e,users:t})});return(await a.json()).optimal_times.map(e=>new Date(e))}},this.aiServiceUrl=e}async makeRequestWithRetry(e,t,a=this.retryAttempts){for(let s=0;s<=a;s++)try{let r=new AbortController,i=setTimeout(()=>r.abort(),this.requestTimeout),n=await fetch(e,{...t,signal:r.signal});if(clearTimeout(i),n.ok)return n;if(s===a)throw Error(`HTTP ${n.status}: ${n.statusText}`);await new Promise(e=>setTimeout(e,1e3*(s+1)))}catch(e){if(s===a)throw e;console.warn(`请求失败 (尝试 ${s+1}/${a+1}):`,e),await new Promise(e=>setTimeout(e,1e3*(s+1)))}throw Error("所有重试尝试都失败了")}generateFallbackVector(e,t=384){let a=Array(t).fill(0),s=Math.min(e.length/1e3,1);a[0]=s;let r={};for(let t of e.toLowerCase())r[t]=(r[t]||0)+1;let i=1;for(let[s,n]of Object.entries(r).slice(0,10))i<t&&(a[i]=Math.min(n/e.length,1),i++);let n=["好","棒","喜欢","爱","开心","快乐","美丽","优秀"];for(let s=0;s<n.length&&i<t;s++)e.includes(n[s])&&(a[i]=1),i++;let l=Math.sqrt(a.reduce((e,t)=>e+t*t,0));if(l>0)for(let e=0;e<a.length;e++)a[e]=a[e]/l;return a}fallbackContentAnalysis(e){let t=["好","棒","喜欢","爱","开心","快乐","美丽","优秀"].filter(t=>e.includes(t)).length,a=["坏","差","讨厌","恨","难过","痛苦","丑陋","糟糕"].filter(t=>e.includes(t)).length,s="neutral";t>a?s="positive":a>t&&(s="negative");let r=[];for(let[t,a]of Object.entries({生活:["生活","日常","今天","昨天","明天"],科技:["科技","技术","AI","人工智能","编程"],艺术:["艺术","音乐","绘画","创作","设计"],旅行:["旅行","旅游","风景","景点","度假"],美食:["美食","食物","餐厅","烹饪","味道"]}))a.some(t=>e.includes(t))&&r.push(t);let i=e.split(/\s+/).filter(e=>e.length>1).slice(0,5),n=Math.min(100,Math.max(0,100-.1*e.length)),l=Math.min(100,Math.max(0,.5*n+10*t+15*r.length));return{sentiment:s,topics:r,keywords:i,readability:n,engagement_potential:l}}fallbackTagExtraction(e){let t=this.fallbackContentAnalysis(e);return[...t.topics,...t.keywords.slice(0,3)].slice(0,5)}}let o=new c,d=({currentUser:e,onSeedCreated:t,className:a})=>{let[i,c]=(0,r.useState)([{id:(0,l.Ox)(),role:"assistant",content:"你好！我是你的 AI 创作助手。你想创作什么样的星种？描述你的想法，我会帮你优化和传播。",timestamp:new Date}]),[d,m]=(0,r.useState)(""),[p,h]=(0,r.useState)(!1),[u,x]=(0,r.useState)(!1),[y,g]=(0,r.useState)(!1),[f,j]=(0,r.useState)(null),[v,b]=(0,r.useState)([]),[w,_]=(0,r.useState)(""),N=(0,r.useRef)(null),{analyzeContent:S,generateContentVector:k,extractSpectralTags:P}=o.contentAgent,C=()=>{N.current?.scrollIntoView({behavior:"smooth"})};(0,r.useEffect)(()=>{C()},[i]);let O=async()=>{if(!d.trim()||p)return;let t={id:(0,l.Ox)(),role:"user",content:d.trim(),timestamp:new Date};c(e=>[...e,t]),m(""),h(!0);try{let t=await S(d.trim()),a=await T(d.trim(),t),s=await P(a),r=await M(a,t),i=D(t,a),n={id:(0,l.Ox)(),role:"assistant",content:R(a,t,i),metadata:{suggested_content:a,confidence:i,estimated_reach:r,spectral_tags:s},timestamp:new Date};c(e=>[...e,n]),i>.8&&(j({id:(0,l.Ox)(),creator:e.id,content:a,content_type:"text",location:e.location,content_vector:[],spectral_tags:s,luminosity:Math.round(100*i),resonance_count:0,status:"active",created:new Date().toISOString(),updated:new Date().toISOString()}),b(s))}catch(t){console.error("AI 生成失败:",t);let e={id:(0,l.Ox)(),role:"assistant",content:"抱歉，我遇到了一些问题。请稍后再试，或者尝试重新描述你的想法。",timestamp:new Date};c(t=>[...t,e])}finally{h(!1)}},T=async(e,t)=>{let a=[`${e} - 这是一个很棒的想法！`,`关于"${e}"的思考：这让我想起了...`,`分享：${e}，希望能引起大家的共鸣`,`感悟：${e}，生活就是这样美好`];return a[Math.floor(Math.random()*a.length)]},M=async(e,t)=>Math.round((Math.floor(500*Math.random())+100)*("positive"===t.sentiment?1.5:1)*(t.topics.includes("生活")?1.3:1)),D=(e,t)=>{let a=.5;return t.length>20&&t.length<200&&(a+=.2),"positive"===e.sentiment&&(a+=.2),e.topics.length>0&&(a+=.1),Math.min(1,a)},R=(e,t,a)=>a>.8?`我为你优化了这个内容："${e}"。这个星种很有潜力，预计能传播给 ${Math.floor(500*Math.random())+100} 人。你觉得怎么样？`:a>.6?`我理解你的想法。让我为你优化一下："${e}"。这个内容还不错，但可能需要一些调整。`:`我理解你的想法，但可能需要更多信息来帮你创作。你能再详细描述一下吗？`,q=async()=>{if(f){x(!0);try{let e={...f,spectral_tags:v,created:new Date().toISOString(),updated:new Date().toISOString()};await new Promise(e=>setTimeout(e,1e3)),t(e),j(null),b([]),g(!1);let a={id:(0,l.Ox)(),role:"assistant",content:"\uD83C\uDF89 星种创建成功！它已经开始在星空中传播了。",timestamp:new Date};c(e=>[...e,a])}catch(e){console.error("创建星种失败:",e)}finally{x(!1)}}},A=()=>{w.trim()&&!v.includes(w.trim())&&(b(e=>[...e,w.trim()]),_(""))},$=e=>{b(t=>t.filter(t=>t!==e))};return(0,s.jsxs)("div",{className:(0,l.cn)("flex flex-col h-full",a),children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[i.map(t=>s.jsx("div",{className:(0,l.cn)("flex","user"===t.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:(0,l.cn)("max-w-[80%] rounded-2xl px-4 py-3","user"===t.role?"bg-gradient-gold text-black":"bg-primary-card text-text-primary"),children:[s.jsx("p",{className:"text-sm",children:t.content}),"assistant"===t.role&&t.metadata&&(0,s.jsxs)("div",{className:"mt-2 space-y-2",children:[t.metadata.confidence&&(0,s.jsxs)("div",{className:"text-xs text-text-secondary",children:["置信度: ",Math.round(100*t.metadata.confidence),"%"]}),t.metadata.estimated_reach&&(0,s.jsxs)("div",{className:"text-xs text-text-secondary",children:["预计传播: ",t.metadata.estimated_reach," 人"]}),t.metadata.spectral_tags&&t.metadata.spectral_tags.length>0&&s.jsx("div",{className:"flex gap-1 flex-wrap",children:t.metadata.spectral_tags.map((e,t)=>(0,s.jsxs)(n.Vp,{variant:"cyan",size:"sm",children:["#",e]},t))}),t.metadata.suggested_content&&t.metadata.confidence&&t.metadata.confidence>.6&&(0,s.jsxs)(n.zx,{size:"sm",variant:"secondary",onClick:()=>{j({id:(0,l.Ox)(),creator:e.id,content:t.metadata.suggested_content,content_type:"text",location:e.location,content_vector:[],spectral_tags:t.metadata.spectral_tags||[],luminosity:Math.round(100*t.metadata.confidence),resonance_count:0,status:"active",created:new Date().toISOString(),updated:new Date().toISOString()}),b(t.metadata.spectral_tags||[]),g(!0)},className:"mt-2",children:[s.jsx("i",{className:"fas fa-eye mr-1"}),"预览星种"]})]}),s.jsx("div",{className:"text-xs text-text-secondary mt-1",children:(0,l.p6)(t.timestamp)})]})},t.id)),p&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"bg-primary-card text-text-primary rounded-2xl px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(n.gb,{size:"sm"}),s.jsx("span",{className:"text-sm",children:"AI 思考中..."})]})})}),s.jsx("div",{ref:N})]}),s.jsx("div",{className:"border-t border-white/10 p-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(n.gx,{value:d,onChange:e=>m(e.target.value),placeholder:"描述你的想法...",disabled:p,className:"flex-1 min-h-[60px] resize-none",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),O())}}),s.jsx(n.zx,{onClick:O,disabled:!d.trim()||p,className:"self-end",children:p?s.jsx(n.gb,{size:"sm"}):s.jsx("i",{className:"fas fa-paper-plane"})})]})}),s.jsx(n.u_,{isOpen:y,onClose:()=>g(!1),title:"星种预览",size:"lg",children:f&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"星种内容"}),s.jsx("div",{className:"bg-primary-secondary rounded-xl p-4 text-text-primary",children:f.content})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"光谱标签"}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex gap-2 flex-wrap",children:v.map((e,t)=>(0,s.jsxs)(n.Vp,{variant:"cyan",className:"cursor-pointer",onClick:()=>$(e),children:["#",e," ",s.jsx("i",{className:"fas fa-times ml-1"})]},t))}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(n.II,{value:w,onChange:e=>_(e.target.value),placeholder:"添加自定义标签",className:"flex-1",onKeyDown:e=>{"Enter"===e.key&&A()}}),s.jsx(n.zx,{onClick:A,variant:"secondary",children:s.jsx("i",{className:"fas fa-plus"})})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"光度值"}),s.jsx("div",{className:"bg-primary-secondary rounded-xl p-3 text-center",children:(0,s.jsxs)("span",{className:"text-2xl font-bold text-accent-gold",children:[f.luminosity,"\xb0C"]})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"预计传播"}),(0,s.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-3 text-center",children:[s.jsx("span",{className:"text-2xl font-bold text-accent-red",children:Math.floor(500*Math.random())+100}),s.jsx("div",{className:"text-sm text-text-secondary",children:"人"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsxs)(n.zx,{onClick:q,loading:u,className:"flex-1",children:[s.jsx("i",{className:"fas fa-rocket mr-2"}),"发射星种"]}),s.jsx(n.zx,{onClick:()=>g(!1),variant:"secondary",children:"取消"})]})]})})]})};var m=a(8551),p=a(5047);function h(){let e=(0,p.useRouter)(),t=m.pb.authStore.model||{};return(0,s.jsxs)("div",{className:"min-h-screen bg-primary-bg",children:[s.jsx(i.tD,{title:"创建星种",user:{name:t.username||"用户",avatar:t.avatar},onMenuClick:()=>e.push("/"),onProfileClick:()=>e.push("/profile")}),s.jsx("main",{className:"pt-16 pb-20 px-4",children:s.jsx("div",{className:"max-w-md mx-auto h-[calc(100vh-8rem)]",children:s.jsx(d,{currentUser:t,onSeedCreated:t=>{e.push("/")},className:"h-full"})})}),s.jsx(i.LJ,{currentPage:"create",onPageChange:t=>e.push("home"===t?"/":`/${t}`)})]})}},7007:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(8570).createProxy)(String.raw`/Users/mac/Desktop/code/flulink/src/app/(main)/create/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[948,347,325,573,626],()=>a(6825));module.exports=s})();
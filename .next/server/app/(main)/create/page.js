(()=>{var e={};e.id=50,e.ids=[50],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},8195:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>r.a,__next_app__:()=>p,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>o}),a(7007),a(5866),a(2029);var s=a(3191),i=a(8716),n=a(7922),r=a.n(n),l=a(5231),c={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>l[e]);a.d(t,c);let o=["",{children:["(main)",{children:["create",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,7007)),"/Users/mac/Desktop/code/flulink/src/app/(main)/create/page.tsx"]}]},{}]},{"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,2029)),"/Users/mac/Desktop/code/flulink/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,5866,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/mac/Desktop/code/flulink/src/app/(main)/create/page.tsx"],m="/(main)/create/page",p={require:a,loadChunk:()=>Promise.resolve()},x=new s.AppPageRouteModule({definition:{kind:i.x.APP_PAGE,page:"/(main)/create/page",pathname:"/create",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},8469:(e,t,a)=>{Promise.resolve().then(a.bind(a,3789))},3789:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>x});var s=a(326),i=a(7577),n=a(1364),r=a(2068),l=a(1223);class c{constructor(e=process.env.NEXT_PUBLIC_AI_SERVICE_URL||"http://localhost:8000"){this.propagationAgent={async calculatePropagationPath(e,t){return(await fetch(`${this.aiServiceUrl}/api/ai/optimize-propagation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:e,context:t})})).json()},async predictPropagationPotential(e){let t=await fetch(`${this.aiServiceUrl}/api/ai/predict-potential`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:e})});return(await t.json()).potential_score}},this.matchingAgent={async findSimilarUsers(e,t,a=10){let s=await fetch(`${this.aiServiceUrl}/api/ai/find-similar-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed_vector:e,user_pool:t.map(e=>({id:e.id,interest_vector:e.interest_vector})),limit:a})});return(await s.json()).similar_users},async calculateUserCompatibility(e,t){let a=await fetch(`${this.aiServiceUrl}/api/ai/calculate-compatibility`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user1:e,user2:t})});return(await a.json()).compatibility_score}},this.contentAgent={async analyzeContent(e){return(await fetch(`${this.aiServiceUrl}/api/ai/analyze-content`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})})).json()},async generateContentVector(e){let t=await fetch(`${this.aiServiceUrl}/api/ai/embed-text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:e})});return(await t.json()).vector},async extractSpectralTags(e){let t=await fetch(`${this.aiServiceUrl}/api/ai/extract-tags`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e})});return(await t.json()).tags}},this.optimizationAgent={async optimizePropagationPath(e){return(await fetch(`${this.aiServiceUrl}/api/ai/optimize-path`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:e})})).json()},async calculateOptimalTiming(e,t){let a=await fetch(`${this.aiServiceUrl}/api/ai/calculate-timing`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed:e,users:t})});return(await a.json()).optimal_times.map(e=>new Date(e))}},this.aiServiceUrl=e}}let o=new c,d=({currentUser:e,onSeedCreated:t,className:a})=>{let[n,c]=(0,i.useState)([{id:(0,l.Ox)(),role:"assistant",content:"你好！我是你的 AI 创作助手。你想创作什么样的星种？描述你的想法，我会帮你优化和传播。",timestamp:new Date}]),[d,m]=(0,i.useState)(""),[p,x]=(0,i.useState)(!1),[h,u]=(0,i.useState)(!1),[g,y]=(0,i.useState)(!1),[f,j]=(0,i.useState)(null),[v,N]=(0,i.useState)([]),[b,S]=(0,i.useState)(""),_=(0,i.useRef)(null),{analyzeContent:w,generateContentVector:P,extractSpectralTags:O}=o.contentAgent,C=()=>{_.current?.scrollIntoView({behavior:"smooth"})};(0,i.useEffect)(()=>{C()},[n]);let k=async()=>{if(!d.trim()||p)return;let t={id:(0,l.Ox)(),role:"user",content:d.trim(),timestamp:new Date};c(e=>[...e,t]),m(""),x(!0);try{let t=await w(d.trim()),a=await T(d.trim(),t),s=await O(a),i=await D(a,t),n=U(t,a),r={id:(0,l.Ox)(),role:"assistant",content:z(a,t,n),metadata:{suggested_content:a,confidence:n,estimated_reach:i,spectral_tags:s},timestamp:new Date};c(e=>[...e,r]),n>.8&&(j({id:(0,l.Ox)(),creator:e.id,content:a,content_type:"text",location:e.location,content_vector:[],spectral_tags:s,luminosity:Math.round(100*n),resonance_count:0,status:"active",created:new Date().toISOString(),updated:new Date().toISOString()}),N(s))}catch(t){console.error("AI 生成失败:",t);let e={id:(0,l.Ox)(),role:"assistant",content:"抱歉，我遇到了一些问题。请稍后再试，或者尝试重新描述你的想法。",timestamp:new Date};c(t=>[...t,e])}finally{x(!1)}},T=async(e,t)=>{let a=[`${e} - 这是一个很棒的想法！`,`关于"${e}"的思考：这让我想起了...`,`分享：${e}，希望能引起大家的共鸣`,`感悟：${e}，生活就是这样美好`];return a[Math.floor(Math.random()*a.length)]},D=async(e,t)=>Math.round((Math.floor(500*Math.random())+100)*("positive"===t.sentiment?1.5:1)*(t.topics.includes("生活")?1.3:1)),U=(e,t)=>{let a=.5;return t.length>20&&t.length<200&&(a+=.2),"positive"===e.sentiment&&(a+=.2),e.topics.length>0&&(a+=.1),Math.min(1,a)},z=(e,t,a)=>a>.8?`我为你优化了这个内容："${e}"。这个星种很有潜力，预计能传播给 ${Math.floor(500*Math.random())+100} 人。你觉得怎么样？`:a>.6?`我理解你的想法。让我为你优化一下："${e}"。这个内容还不错，但可能需要一些调整。`:`我理解你的想法，但可能需要更多信息来帮你创作。你能再详细描述一下吗？`,M=async()=>{if(f){u(!0);try{let e={...f,spectral_tags:v,created:new Date().toISOString(),updated:new Date().toISOString()};await new Promise(e=>setTimeout(e,1e3)),t(e),j(null),N([]),y(!1);let a={id:(0,l.Ox)(),role:"assistant",content:"\uD83C\uDF89 星种创建成功！它已经开始在星空中传播了。",timestamp:new Date};c(e=>[...e,a])}catch(e){console.error("创建星种失败:",e)}finally{u(!1)}}},$=()=>{b.trim()&&!v.includes(b.trim())&&(N(e=>[...e,b.trim()]),S(""))},I=e=>{N(t=>t.filter(t=>t!==e))};return(0,s.jsxs)("div",{className:(0,l.cn)("flex flex-col h-full",a),children:[(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[n.map(t=>s.jsx("div",{className:(0,l.cn)("flex","user"===t.role?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:(0,l.cn)("max-w-[80%] rounded-2xl px-4 py-3","user"===t.role?"bg-gradient-gold text-black":"bg-primary-card text-text-primary"),children:[s.jsx("p",{className:"text-sm",children:t.content}),"assistant"===t.role&&t.metadata&&(0,s.jsxs)("div",{className:"mt-2 space-y-2",children:[t.metadata.confidence&&(0,s.jsxs)("div",{className:"text-xs text-text-secondary",children:["置信度: ",Math.round(100*t.metadata.confidence),"%"]}),t.metadata.estimated_reach&&(0,s.jsxs)("div",{className:"text-xs text-text-secondary",children:["预计传播: ",t.metadata.estimated_reach," 人"]}),t.metadata.spectral_tags&&t.metadata.spectral_tags.length>0&&s.jsx("div",{className:"flex gap-1 flex-wrap",children:t.metadata.spectral_tags.map((e,t)=>(0,s.jsxs)(r.Vp,{variant:"cyan",size:"sm",children:["#",e]},t))}),t.metadata.suggested_content&&t.metadata.confidence&&t.metadata.confidence>.6&&(0,s.jsxs)(r.zx,{size:"sm",variant:"secondary",onClick:()=>{j({id:(0,l.Ox)(),creator:e.id,content:t.metadata.suggested_content,content_type:"text",location:e.location,content_vector:[],spectral_tags:t.metadata.spectral_tags||[],luminosity:Math.round(100*t.metadata.confidence),resonance_count:0,status:"active",created:new Date().toISOString(),updated:new Date().toISOString()}),N(t.metadata.spectral_tags||[]),y(!0)},className:"mt-2",children:[s.jsx("i",{className:"fas fa-eye mr-1"}),"预览星种"]})]}),s.jsx("div",{className:"text-xs text-text-secondary mt-1",children:(0,l.p6)(t.timestamp)})]})},t.id)),p&&s.jsx("div",{className:"flex justify-start",children:s.jsx("div",{className:"bg-primary-card text-text-primary rounded-2xl px-4 py-3",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[s.jsx(r.gb,{size:"sm"}),s.jsx("span",{className:"text-sm",children:"AI 思考中..."})]})})}),s.jsx("div",{ref:_})]}),s.jsx("div",{className:"border-t border-white/10 p-4",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(r.gx,{value:d,onChange:e=>m(e.target.value),placeholder:"描述你的想法...",disabled:p,className:"flex-1 min-h-[60px] resize-none",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),k())}}),s.jsx(r.zx,{onClick:k,disabled:!d.trim()||p,className:"self-end",children:p?s.jsx(r.gb,{size:"sm"}):s.jsx("i",{className:"fas fa-paper-plane"})})]})}),s.jsx(r.u_,{isOpen:g,onClose:()=>y(!1),title:"星种预览",size:"lg",children:f&&(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"星种内容"}),s.jsx("div",{className:"bg-primary-secondary rounded-xl p-4 text-text-primary",children:f.content})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"光谱标签"}),(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("div",{className:"flex gap-2 flex-wrap",children:v.map((e,t)=>(0,s.jsxs)(r.Vp,{variant:"cyan",className:"cursor-pointer",onClick:()=>I(e),children:["#",e," ",s.jsx("i",{className:"fas fa-times ml-1"})]},t))}),(0,s.jsxs)("div",{className:"flex gap-2",children:[s.jsx(r.II,{value:b,onChange:e=>S(e.target.value),placeholder:"添加自定义标签",className:"flex-1",onKeyDown:e=>{"Enter"===e.key&&$()}}),s.jsx(r.zx,{onClick:$,variant:"secondary",children:s.jsx("i",{className:"fas fa-plus"})})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"光度值"}),s.jsx("div",{className:"bg-primary-secondary rounded-xl p-3 text-center",children:(0,s.jsxs)("span",{className:"text-2xl font-bold text-accent-gold",children:[f.luminosity,"\xb0C"]})})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-text-primary mb-2",children:"预计传播"}),(0,s.jsxs)("div",{className:"bg-primary-secondary rounded-xl p-3 text-center",children:[s.jsx("span",{className:"text-2xl font-bold text-accent-red",children:Math.floor(500*Math.random())+100}),s.jsx("div",{className:"text-sm text-text-secondary",children:"人"})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,s.jsxs)(r.zx,{onClick:M,loading:h,className:"flex-1",children:[s.jsx("i",{className:"fas fa-rocket mr-2"}),"发射星种"]}),s.jsx(r.zx,{onClick:()=>y(!1),variant:"secondary",children:"取消"})]})]})})]})};var m=a(8551),p=a(5047);function x(){let e=(0,p.useRouter)(),t=m.pb.authStore.model||{};return(0,s.jsxs)("div",{className:"min-h-screen bg-primary-bg",children:[s.jsx(n.tD,{title:"创建星种",user:{name:t.username||"用户",avatar:t.avatar},onMenuClick:()=>e.push("/"),onProfileClick:()=>e.push("/profile")}),s.jsx("main",{className:"pt-16 pb-20 px-4",children:s.jsx("div",{className:"max-w-md mx-auto h-[calc(100vh-8rem)]",children:s.jsx(d,{currentUser:t,onSeedCreated:t=>{e.push("/")},className:"h-full"})})}),s.jsx(n.LJ,{currentPage:"create",onPageChange:t=>e.push("home"===t?"/":`/${t}`)})]})}},7007:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});let s=(0,a(8570).createProxy)(String.raw`/Users/mac/Desktop/code/flulink/src/app/(main)/create/page.tsx#default`)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),s=t.X(0,[948,347,325,599,713],()=>a(8195));module.exports=s})();
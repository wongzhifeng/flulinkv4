"use strict";(()=>{var t={};t.id=121,t.ids=[121],t.modules={399:t=>{t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:t=>{t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8558:(t,e,a)=>{a.r(e),a.d(e,{originalPathname:()=>d,patchFetch:()=>y,requestAsyncStorage:()=>p,routeModule:()=>h,serverHooks:()=>m,staticGenerationAsyncStorage:()=>u});var i={};a.r(i),a.d(i,{POST:()=>c});var r=a(9303),n=a(8716),s=a(670),o=a(7070);let l=new(a(2660)).uN;async function c(t){try{let{seedVector:e,userPool:a,topK:i}=await t.json(),r=await l.matchingAgent.findSimilarUsers(e,a,i);return o.NextResponse.json({similarUsers:r})}catch(t){return console.error("Similar Users API Error:",t),o.NextResponse.json({error:"Failed to find similar users"},{status:500})}}let h=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/agentrouter/matching/similar-users/route",pathname:"/api/agentrouter/matching/similar-users",filename:"route",bundlePath:"app/api/agentrouter/matching/similar-users/route"},resolvedPagePath:"/Users/mac/Desktop/code/flulink/src/app/api/agentrouter/matching/similar-users/route.ts",nextConfigOutput:"export",userland:i}),{requestAsyncStorage:p,staticGenerationAsyncStorage:u,serverHooks:m}=h,d="/api/agentrouter/matching/similar-users/route";function y(){return(0,s.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:u})}},2660:(t,e,a)=>{a.d(e,{uN:()=>i}),a(1159);class i{constructor(t=process.env.NEXT_PUBLIC_AI_SERVICE_URL||"http://localhost:8000"){this.requestTimeout=1e4,this.retryAttempts=2,this.fallbackEnabled=!0,this.propagationAgent={async calculatePropagationPath(t,e){try{let a=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/optimize-propagation`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:t,context:e})});return(await a.json()).optimal_path}catch(e){return console.warn("传播路径计算失败，使用降级策略:",e),{seedId:t.id,firstTargets:[],propagationSequence:[],estimatedReach:0,confidence:.1}}},async predictPropagationPotential(t){try{let e=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/predict-potential`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({star_seed:t})});return(await e.json()).potential_score}catch(e){return console.warn("传播潜力预测失败，使用降级策略:",e),Math.min(100,Math.max(0,t.content?.length||0))}}},this.matchingAgent={async findSimilarUsers(t,e,a=10){try{let i=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/find-similar-users`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed_vector:t,user_pool:e.map(t=>({id:t.id,interest_vector:t.interest_vector})),limit:a})});return(await i.json()).similar_users}catch(t){return console.warn("相似用户查找失败，使用降级策略:",t),e.slice(0,a)}},async calculateUserCompatibility(t,e){try{let a=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/calculate-compatibility`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user1:t,user2:e})});return(await a.json()).compatibility_score}catch(a){if(console.warn("用户兼容性计算失败，使用降级策略:",a),t.interest_vector&&e.interest_vector){let a=t.interest_vector.reduce((t,a,i)=>t+a*(e.interest_vector?.[i]||0),0),i=Math.sqrt(t.interest_vector.reduce((t,e)=>t+e*e,0)),r=Math.sqrt(e.interest_vector.reduce((t,e)=>t+e*e,0));return i*r>0?a/(i*r):0}return .5*Math.random()+.3}}},this.contentAgent={async analyzeContent(t){try{let e=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/analyze-content`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})});return await e.json()}catch(e){return console.warn("内容分析失败，使用降级策略:",e),this.fallbackContentAnalysis(t)}},async generateContentVector(t){try{let e=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/embed-text`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text:t})});return(await e.json()).vector}catch(e){return console.warn("内容向量生成失败，使用降级策略:",e),this.generateFallbackVector(t)}},async extractSpectralTags(t){try{let e=await this.makeRequestWithRetry(`${this.aiServiceUrl}/api/ai/extract-tags`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:t})});return(await e.json()).tags}catch(e){return console.warn("光谱标签提取失败，使用降级策略:",e),this.fallbackTagExtraction(t)}}},this.optimizationAgent={async optimizePropagationPath(t){return(await fetch(`${this.aiServiceUrl}/api/ai/optimize-path`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t})})).json()},async calculateOptimalTiming(t,e){let a=await fetch(`${this.aiServiceUrl}/api/ai/calculate-timing`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({seed:t,users:e})});return(await a.json()).optimal_times.map(t=>new Date(t))}},this.aiServiceUrl=t}async makeRequestWithRetry(t,e,a=this.retryAttempts){for(let i=0;i<=a;i++)try{let r=new AbortController,n=setTimeout(()=>r.abort(),this.requestTimeout),s=await fetch(t,{...e,signal:r.signal});if(clearTimeout(n),s.ok)return s;if(i===a)throw Error(`HTTP ${s.status}: ${s.statusText}`);await new Promise(t=>setTimeout(t,1e3*(i+1)))}catch(t){if(i===a)throw t;console.warn(`请求失败 (尝试 ${i+1}/${a+1}):`,t),await new Promise(t=>setTimeout(t,1e3*(i+1)))}throw Error("所有重试尝试都失败了")}generateFallbackVector(t,e=384){let a=Array(e).fill(0),i=Math.min(t.length/1e3,1);a[0]=i;let r={};for(let e of t.toLowerCase())r[e]=(r[e]||0)+1;let n=1;for(let[i,s]of Object.entries(r).slice(0,10))n<e&&(a[n]=Math.min(s/t.length,1),n++);let s=["好","棒","喜欢","爱","开心","快乐","美丽","优秀"];for(let i=0;i<s.length&&n<e;i++)t.includes(s[i])&&(a[n]=1),n++;let o=Math.sqrt(a.reduce((t,e)=>t+e*e,0));if(o>0)for(let t=0;t<a.length;t++)a[t]=a[t]/o;return a}fallbackContentAnalysis(t){let e=["好","棒","喜欢","爱","开心","快乐","美丽","优秀"].filter(e=>t.includes(e)).length,a=["坏","差","讨厌","恨","难过","痛苦","丑陋","糟糕"].filter(e=>t.includes(e)).length,i="neutral";e>a?i="positive":a>e&&(i="negative");let r=[];for(let[e,a]of Object.entries({生活:["生活","日常","今天","昨天","明天"],科技:["科技","技术","AI","人工智能","编程"],艺术:["艺术","音乐","绘画","创作","设计"],旅行:["旅行","旅游","风景","景点","度假"],美食:["美食","食物","餐厅","烹饪","味道"]}))a.some(e=>t.includes(e))&&r.push(e);let n=t.split(/\s+/).filter(t=>t.length>1).slice(0,5),s=Math.min(100,Math.max(0,100-.1*t.length)),o=Math.min(100,Math.max(0,.5*s+10*e+15*r.length));return{sentiment:i,topics:r,keywords:n,readability:s,engagement_potential:o}}fallbackTagExtraction(t){let e=this.fallbackContentAnalysis(t);return[...e.topics,...e.keywords.slice(0,3)].slice(0,5)}}new i}};var e=require("../../../../../webpack-runtime.js");e.C(t);var a=t=>e(e.s=t),i=e.X(0,[948,972],()=>a(8558));module.exports=i})();
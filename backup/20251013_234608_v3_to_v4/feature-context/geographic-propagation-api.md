# 地理传播算法API实现计划

## 项目背景
基于《德道经》"无为而治"哲学，实现分布式流感式社交网络的核心传播算法。

## 核心API设计

### 1. 传播任务创建API
**端点**: `POST /api/propagation/create`
**功能**: 创建新的地理传播任务
**输入**: 毒株信息、用户位置、传播参数
**输出**: 传播任务ID、预计传播路径

### 2. 传播状态查询API
**端点**: `GET /api/propagation/status/:id`
**功能**: 查询传播任务的实时状态
**输入**: 传播任务ID
**输出**: 传播进度、感染统计、地理分布

### 3. 用户感染API
**端点**: `POST /api/propagation/infect`
**功能**: 用户主动感染毒株
**输入**: 用户位置、毒株ID、感染参数
**输出**: 感染结果、传播影响

### 4. 附近传播查询API
**端点**: `GET /api/propagation/nearby`
**功能**: 获取用户附近的活跃传播
**输入**: 用户位置、查询半径
**输出**: 附近传播列表、感染概率

## 地理层级传播机制

### 层级定义
1. **家级** (0-1km) - 邻里传播，高感染率
2. **社区级** (1-5km) - 社区传播，中等感染率
3. **城市级** (5-50km) - 城市传播，低感染率
4. **区域级** (50km+) - 区域传播，极低感染率

### 传播算法
- **距离衰减**: 基于真实地理距离的感染概率计算
- **时间延迟**: 不同层级的传播时间延迟
- **用户行为**: 基于用户活跃度的传播影响
- **自然衰减**: 传播的自然衰减机制

## 技术实现要点

### 1. Bun运行时优化
- 异步处理传播计算
- 内存优化的数据结构
- 高效的JSON序列化

### 2. 边缘计算设计
- 就近处理传播逻辑
- 减少网络延迟
- 提高响应速度

### 3. 响应式更新
- 实时传播状态更新
- 动态感染统计
- 地理分布可视化

### 4. 哲学一致性
- "无为而治" - 用户自主传播
- "民自化" - 自然传播机制
- "道法自然" - 基于地理的传播

## 实现步骤

### 阶段1: 核心算法实现
1. 地理距离计算
2. 感染概率算法
3. 传播时间延迟
4. 用户行为模型

### 阶段2: API端点开发
1. 传播任务创建
2. 状态查询接口
3. 感染处理逻辑
4. 附近传播查询

### 阶段3: 性能优化
1. Bun运行时优化
2. 内存使用优化
3. 响应时间优化
4. 并发处理优化

### 阶段4: 测试验证
1. 单元测试
2. 集成测试
3. 性能测试
4. 用户体验测试

## 预期成果
- 完整的地理传播算法API
- 高性能的传播计算引擎
- 符合哲学理念的传播机制
- 可扩展的传播系统架构
